---
layout: base.njk
title: ç•™è¨€æ¿
description: åœ¨è¿™é‡Œç•™ä¸‹ä½ çš„è¶³è¿¹ï¼Œåˆ†äº«ä½ çš„æƒ³æ³•
keywords: ç•™è¨€, äº¤æµ, åé¦ˆ, è”ç³»
---

<section class="guestbook-section">
  <div class="section-header">
    <h1 class="handwriting">ç•™è¨€æ¿</h1>
    <p class="section-subtitle">åœ¨è¿™é‡Œç•™ä¸‹ä½ çš„è¶³è¿¹ï¼Œåˆ†äº«ä½ çš„æƒ³æ³•</p>
  </div>
  
  <div class="guestbook-container">
    <!-- ç•™è¨€è¡¨å• -->
    <div class="message-form-section glass">
      <h2>å†™ä¸‹ä½ çš„ç•™è¨€</h2>
      <form id="messageForm" class="message-form">
        <div class="form-group">
          <label for="name">åå­— *</label>
          <input type="text" id="name" name="name" required placeholder="è¯·è¾“å…¥ä½ çš„åå­—">
        </div>
        
        <div class="form-group">
          <label for="email">é‚®ç®±</label>
          <input type="email" id="email" name="email" placeholder="your@email.com (é€‰å¡«)">
        </div>
        
        <div class="form-group">
          <label for="website">ç½‘ç«™</label>
          <input type="url" id="website" name="website" placeholder="https://your-website.com (é€‰å¡«)">
        </div>
        
        <div class="form-group">
          <label for="mood">å¿ƒæƒ…æ ‡ç­¾</label>
          <div class="mood-selector">
            <button type="button" class="mood-btn" data-mood="ğŸ˜Š">ğŸ˜Š å¼€å¿ƒ</button>
            <button type="button" class="mood-btn" data-mood="ğŸ¤”">ğŸ¤” æ€è€ƒ</button>
            <button type="button" class="mood-btn" data-mood="ğŸŒŸ">ğŸŒŸ èµå¹</button>
            <button type="button" class="mood-btn" data-mood="ğŸ“š">ğŸ“š å­¦ä¹ </button>
            <button type="button" class="mood-btn" data-mood="ğŸŒ¿">ğŸŒ¿ è‡ªç„¶</button>
          </div>
          <input type="hidden" id="mood" name="mood" value="">
          <input type="hidden" id="replyTo" name="replyTo" value="">
        </div>
        
        <div class="reply-indicator" id="replyIndicator" style="display: none;"></div>
        
        <div class="form-group">
          <label for="message">ç•™è¨€å†…å®¹ *</label>
          <textarea id="message" name="message" required rows="5" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•ã€å»ºè®®æˆ–è€…ä»»ä½•æƒ³è¯´çš„è¯..."></textarea>
        </div>
        
        <button type="submit" class="submit-btn">
          <span>å‘é€ç•™è¨€</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 2L11 13M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </form>
    </div>
    
    <!-- ç•™è¨€åˆ—è¡¨ -->
    <div class="messages-section">
      <h2>è®¿å®¢ç•™è¨€</h2>
      <div class="messages-list" id="messagesList">
        <!-- ç¤ºä¾‹ç•™è¨€ -->
        <div class="message-item">
          <div class="message-header">
            <div class="message-author">
              <div class="author-avatar">ğŸ‘¤</div>
              <div class="author-info">
                <div class="author-name">è®¿å®¢ç¤ºä¾‹</div>
                <div class="message-date">2024-03-15</div>
              </div>
            </div>
            <div class="message-mood">ğŸ˜Š</div>
          </div>
          <div class="message-content">
            <p>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ç•™è¨€ï¼Œå±•ç¤ºç•™è¨€æ¿çš„æ ·å¼ã€‚ä½ çš„ç•™è¨€å°†ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œï¼Œä¸å…¶ä»–è®¿å®¢åˆ†äº«ä½ çš„æƒ³æ³•ï¼</p>
          </div>
          <div class="message-actions">
            <button class="like-btn" onclick="likeMessage(this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span class="like-count">3</span>
            </button>
            <button class="reply-btn" onclick="replyToMessage(this)">å›å¤</button>
          </div>
        </div>
      </div>
      
      <div class="no-messages" id="noMessages" style="display: none;">
        <div class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <p>è¿˜æ²¡æœ‰ç•™è¨€ï¼Œæˆä¸ºç¬¬ä¸€ä¸ªç•™è¨€çš„äººå§ï¼</p>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
.guestbook-section {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.section-header {
  text-align: center;
  margin-bottom: 3rem;
}

.section-header h1 {
  font-size: 3rem;
  margin-bottom: 1rem;
  background: var(--gradient-secondary);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
}

.section-subtitle {
  font-size: 1.2rem;
  color: var(--text-secondary);
  font-style: italic;
}

.guestbook-container {
  display: grid;
  gap: 3rem;
}

.message-form-section {
  padding: 2rem;
  border-radius: 16px;
}

.message-form-section h2 {
  margin-bottom: 2rem;
  color: var(--text-primary);
  text-align: center;
}

.message-form {
  display: grid;
  gap: 1.5rem;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--text-primary);
}

.form-group input,
.form-group textarea {
  padding: 0.75rem 1rem;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  font-size: 1rem;
  background: var(--bg-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.form-group input:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--accent-light);
  box-shadow: 0 0 0 3px rgba(168, 218, 220, 0.1);
}

.mood-selector {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.mood-btn {
  padding: 0.5rem 1rem;
  border: 2px solid var(--border-color);
  border-radius: 20px;
  background: var(--bg-primary);
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

.mood-btn:hover {
  border-color: var(--accent-light);
  transform: translateY(-2px);
}

.mood-btn.active {
  background: var(--gradient-primary);
  color: white;
  border-color: transparent;
}

.submit-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 1rem 2rem;
  background: var(--gradient-primary);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(168, 218, 220, 0.3);
}

.messages-section h2 {
  margin-bottom: 2rem;
  color: var(--text-primary);
  text-align: center;
}

.messages-list {
  display: grid;
  gap: 1.5rem;
}

.message-item {
  padding: 1.5rem;
  background: var(--bg-card);
  border-radius: 12px;
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
}

.message-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px var(--shadow-medium);
}

.message-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.message-author {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.author-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--gradient-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
}

.author-info {
  display: flex;
  flex-direction: column;
}

.author-name {
  font-weight: 600;
  color: var(--text-primary);
}

.message-date {
  font-size: 0.85rem;
  color: var(--text-secondary);
}

.message-mood {
  font-size: 1.5rem;
}

.message-content {
  margin-bottom: 1rem;
  color: var(--text-primary);
  line-height: 1.6;
}

.message-actions {
  display: flex;
  gap: 1rem;
}

.like-btn,
.reply-btn {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.5rem 1rem;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  background: transparent;
  color: var(--text-secondary);
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.like-btn:hover,
.reply-btn:hover {
  border-color: var(--accent-light);
  color: var(--accent-light);
}

.like-btn.liked {
  color: var(--accent-pink);
  border-color: var(--accent-pink);
  background: rgba(255, 175, 204, 0.1);
}

.no-messages {
  text-align: center;
  padding: 3rem;
  color: var(--text-secondary);
}

.empty-state svg {
  margin-bottom: 1rem;
  opacity: 0.5;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .guestbook-section {
    padding: 1rem;
  }
  
  .mood-selector {
    justify-content: center;
  }
  
  .message-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
  
  .message-actions {
    justify-content: center;
  }
}

/* æ ‘å½¢å›å¤æ ·å¼ */
.message-reply {
  margin-left: 3rem;
  margin-top: 1rem;
  border-left: 3px solid var(--border-color);
  padding-left: 1rem;
  background: var(--bg-secondary);
  border-radius: 0 8px 8px 0;
}

.message-reply:hover {
  border-left-color: var(--accent-light);
}

.replies-section {
  margin-top: 1rem;
  border-top: 1px solid var(--border-color);
  padding-top: 1rem;
}

.replies-header {
  margin-bottom: 1rem;
}

.toggle-replies {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  background: var(--bg-primary);
  color: var(--text-secondary);
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.toggle-replies:hover {
  border-color: var(--accent-light);
  color: var(--accent-light);
}

.replies-list {
  display: block;
  margin-top: 1rem;
}

.replies-list.hidden {
  display: none;
}

/* å›å¤é¢„è§ˆæ ·å¼ */
.reply-preview {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  background: var(--bg-secondary);
  border-radius: 8px;
  margin-bottom: 1rem;
  border-left: 4px solid var(--accent-light);
}

.reply-preview span {
  color: var(--text-primary);
  font-size: 0.9rem;
}

.cancel-reply {
  padding: 0.25rem 0.75rem;
  background: var(--accent-pink);
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.cancel-reply:hover {
  background: var(--accent-pink);
  opacity: 0.8;
}

/* ç‚¹èµæŒ‰é’®ä¼˜åŒ– */
.like-btn {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.5rem 1rem;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  background: transparent;
  color: var(--text-secondary);
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.like-btn:hover {
  border-color: var(--accent-pink);
  color: var(--accent-pink);
}

.like-btn.liked {
  color: var(--accent-pink);
  border-color: var(--accent-pink);
  background: rgba(255, 175, 204, 0.1);
}

.like-btn.liked svg {
  fill: var(--accent-pink);
}

/* å›å¤æŒ‰é’®ä¼˜åŒ– */
.reply-btn {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.5rem 1rem;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  background: transparent;
  color: var(--text-secondary);
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.reply-btn:hover {
  border-color: var(--accent-light);
  color: var(--accent-light);
}

/* ç½‘ç«™é“¾æ¥æ ·å¼ */
.website-link {
  color: var(--accent-light);
  text-decoration: none;
  margin-left: 0.5rem;
  opacity: 0.7;
  transition: opacity 0.3s ease;
}

.website-link:hover {
  opacity: 1;
}

/* æ·±è‰²æ¨¡å¼é€‚é… */
[data-theme="dark"] .message-item {
  background: var(--bg-secondary);
  border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .message-reply {
  background: var(--bg-primary);
  border-left-color: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .message-reply:hover {
  border-left-color: var(--accent-light);
}

[data-theme="dark"] .mood-btn {
  background: var(--bg-secondary);
  border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .toggle-replies {
  background: var(--bg-secondary);
  border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .reply-preview {
  background: var(--bg-primary);
  border-left-color: var(--accent-light);
}
</style>

<script>
// ç•™è¨€æ¿åŠŸèƒ½ - å®Œæ•´çš„æ ‘å½¢å›å¤ç³»ç»Ÿ
document.addEventListener('DOMContentLoaded', function() {
  // åˆå§‹åŒ–
  initializeMoodSelector();
  initializeForm();
  loadMessages();
});

// å¿ƒæƒ…é€‰æ‹©å™¨
function initializeMoodSelector() {
  const moodBtns = document.querySelectorAll('.mood-btn');
  const moodInput = document.getElementById('mood');
  
  moodBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      moodBtns.forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      moodInput.value = this.dataset.mood;
    });
  });
}

// è¡¨å•åˆå§‹åŒ–
function initializeForm() {
  const form = document.getElementById('messageForm');
  const replyToInput = document.getElementById('replyTo');
  
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // è·å–è¡¨å•æ•°æ®
    const formData = new FormData(form);
    const messageData = {
      name: formData.get('name'),
      email: formData.get('email'),
      website: formData.get('website'),
      mood: formData.get('mood'),
      message: formData.get('message'),
      replyTo: replyToInput.value || null,
      date: new Date().toLocaleDateString('zh-CN'),
      timestamp: Date.now(),
      id: generateId(),
      likes: 0,
      liked: false
    };
    
    // éªŒè¯è¡¨å•
    if (!validateForm(messageData)) {
      return;
    }
    
    // ä¿å­˜ç•™è¨€
    saveMessage(messageData);
    
    // é‡ç½®è¡¨å•
    form.reset();
    moodBtns.forEach(btn => btn.classList.remove('active'));
    replyToInput.value = '';
    updateFormMode('normal');
    
    // æ˜¾ç¤ºæˆåŠŸæç¤º
    showNotification('ç•™è¨€å‘é€æˆåŠŸï¼æ„Ÿè°¢ä½ çš„åˆ†äº« ğŸ‰');
  });
}

// ç”Ÿæˆå”¯ä¸€ID
function generateId() {
  return 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// è¡¨å•éªŒè¯
function validateForm(data) {
  if (!data.name.trim()) {
    showNotification('è¯·è¾“å…¥ä½ çš„åå­—', 'error');
    return false;
  }
  
  if (!data.message.trim()) {
    showNotification('è¯·è¾“å…¥ç•™è¨€å†…å®¹', 'error');
    return false;
  }
  
  if (data.message.length > 500) {
    showNotification('ç•™è¨€å†…å®¹ä¸èƒ½è¶…è¿‡500å­—', 'error');
    return false;
  }
  
  return true;
}

// ä¿å­˜ç•™è¨€åˆ°localStorage
function saveMessage(messageData) {
  let messages = JSON.parse(localStorage.getItem('guestbookMessages') || '[]');
  
  // å¦‚æœæ˜¯å›å¤ï¼Œæ‰¾åˆ°çˆ¶æ¶ˆæ¯å¹¶æ·»åŠ åˆ° replies æ•°ç»„
  if (messageData.replyTo) {
    const parentMessage = findMessageById(messages, messageData.replyTo);
    if (parentMessage) {
      if (!parentMessage.replies) {
        parentMessage.replies = [];
      }
      parentMessage.replies.push(messageData);
    }
  } else {
    // æ–°ç•™è¨€æ·»åŠ åˆ°å¼€å¤´
    messages.unshift(messageData);
  }
  
  localStorage.setItem('guestbookMessages', JSON.stringify(messages));
  loadMessages();
}

// æŸ¥æ‰¾æ¶ˆæ¯ï¼ˆåŒ…æ‹¬å›å¤ä¸­çš„æ¶ˆæ¯ï¼‰
function findMessageById(messages, id) {
  for (const message of messages) {
    if (message.id === id) {
      return message;
    }
    if (message.replies) {
      const found = findMessageById(message.replies, id);
      if (found) return found;
    }
  }
  return null;
}

// åŠ è½½ç•™è¨€åˆ—è¡¨
function loadMessages() {
  const messages = JSON.parse(localStorage.getItem('guestbookMessages') || '[]');
  const messagesList = document.getElementById('messagesList');
  const noMessages = document.getElementById('noMessages');
  
  if (messages.length === 0) {
    messagesList.style.display = 'none';
    noMessages.style.display = 'block';
    return;
  }
  
  messagesList.style.display = 'block';
  noMessages.style.display = 'none';
  
  // åŠ è½½ç‚¹èµæ•°æ®
  const likedMessages = JSON.parse(localStorage.getItem('guestbookLikes') || '{}');
  
  // ç”Ÿæˆç•™è¨€HTML
  const messagesHtml = messages.map(message => {
    return createMessageHTML(message, likedMessages);
  }).join('');
  
  messagesList.innerHTML = messagesHtml;
}

// åˆ›å»ºç•™è¨€HTMLï¼ˆæ”¯æŒæ ‘å½¢å›å¤ï¼‰
function createMessageHTML(message, likedMessages = {}) {
  const websiteLink = message.website ? 
    `<a href="${message.website}" target="_blank" rel="noopener noreferrer" class="website-link" title="è®¿é—®ç½‘ç«™">ğŸ”—</a>` : '';
  
  const isLiked = likedMessages[message.id] || message.liked || false;
  const likeCount = message.likes || 0;
  
  let html = `
    <div class="message-item ${message.replyTo ? 'message-reply' : ''}" data-id="${message.id}">
      <div class="message-header">
        <div class="message-author">
          <div class="author-avatar">${message.name.charAt(0).toUpperCase()}</div>
          <div class="author-info">
            <div class="author-name">
              ${escapeHtml(message.name)}
              ${websiteLink}
            </div>
            <div class="message-date">${message.date}</div>
          </div>
        </div>
        <div class="message-mood">${message.mood || 'ğŸ˜Š'}</div>
      </div>
      <div class="message-content">
        <p>${escapeHtml(message.message)}</p>
      </div>
      <div class="message-actions">
        <button class="like-btn ${isLiked ? 'liked' : ''}" onclick="likeMessage('${message.id}')" title="ç‚¹èµ">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="like-count">${likeCount}</span>
        </button>
        <button class="reply-btn" onclick="replyToMessage('${message.id}', '${escapeHtml(message.name)}')" title="å›å¤">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>å›å¤</span>
        </button>
      </div>
      
      ${message.replies && message.replies.length > 0 ? `
        <div class="replies-section">
          <div class="replies-header">
            <button class="toggle-replies" onclick="toggleReplies('${message.id}')">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>${message.replies.length} æ¡å›å¤</span>
            </button>
          </div>
          <div class="replies-list" id="replies-${message.id}">
            ${message.replies.map(reply => createMessageHTML(reply, likedMessages)).join('')}
          </div>
        </div>
      ` : ''}
    </div>
  `;
  
  return html;
}

// ç‚¹èµåŠŸèƒ½ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰
function likeMessage(messageId) {
  let messages = JSON.parse(localStorage.getItem('guestbookMessages') || '[]');
  let likedMessages = JSON.parse(localStorage.getItem('guestbookLikes') || '{}');
  
  // æ›´æ–°ç‚¹èµçŠ¶æ€
  likedMessages[messageId] = !likedMessages[messageId];
  
  // æ›´æ–°æ¶ˆæ¯çš„ç‚¹èµæ•°
  const message = findMessageById(messages, messageId);
  if (message) {
    message.liked = likedMessages[messageId];
    if (likedMessages[messageId]) {
      message.likes = (message.likes || 0) + 1;
    } else {
      message.likes = Math.max(0, (message.likes || 0) - 1);
    }
  }
  
  // ä¿å­˜åˆ°localStorage
  localStorage.setItem('guestbookMessages', JSON.stringify(messages));
  localStorage.setItem('guestbookLikes', JSON.stringify(likedMessages));
  
  // é‡æ–°åŠ è½½ç•™è¨€åˆ—è¡¨
  loadMessages();
}

// å›å¤åŠŸèƒ½
function replyToMessage(messageId, authorName) {
  const form = document.getElementById('messageForm');
  const replyToInput = document.getElementById('replyTo');
  const messageTextarea = document.getElementById('message');
  const replyIndicator = document.getElementById('replyIndicator');
  
  // è®¾ç½®å›å¤ç›®æ ‡
  replyToInput.value = messageId;
  
  // æ›´æ–°è¡¨å•UI
  updateFormMode('reply', authorName);
  
  // æ»šåŠ¨åˆ°è¡¨å•
  form.scrollIntoView({ behavior: 'smooth', block: 'center' });
  
  // èšç„¦åˆ°ç•™è¨€æ¡†
  setTimeout(() => messageTextarea.focus(), 300);
}

// æ›´æ–°è¡¨å•æ¨¡å¼
function updateFormMode(mode, authorName = '') {
  const formTitle = document.querySelector('.message-form-section h2');
  const replyIndicator = document.getElementById('replyIndicator');
  const replyToInput = document.getElementById('replyTo');
  
  if (mode === 'reply') {
    formTitle.textContent = `å›å¤ ${authorName}`;
    if (replyIndicator) {
      replyIndicator.style.display = 'block';
      replyIndicator.innerHTML = `
        <div class="reply-preview">
          <span>æ­£åœ¨å›å¤ <strong>${authorName}</strong></span>
          <button type="button" class="cancel-reply" onclick="cancelReply()">å–æ¶ˆ</button>
        </div>
      `;
    }
  } else {
    formTitle.textContent = 'å†™ä¸‹ä½ çš„ç•™è¨€';
    if (replyIndicator) {
      replyIndicator.style.display = 'none';
    }
    replyToInput.value = '';
  }
}

// å–æ¶ˆå›å¤
function cancelReply() {
  updateFormMode('normal');
}

// åˆ‡æ¢å›å¤æ˜¾ç¤º/éšè—
function toggleReplies(messageId) {
  const repliesList = document.getElementById(`replies-${messageId}`);
  const toggleBtn = repliesList.previousElementSibling.querySelector('.toggle-replies');
  
  if (repliesList.style.display === 'none') {
    repliesList.style.display = 'block';
    toggleBtn.innerHTML = `
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M6 15l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>æ”¶èµ·å›å¤</span>
    `;
  } else {
    repliesList.style.display = 'none';
    toggleBtn.innerHTML = `
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M18 15l-6-6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>å±•å¼€å›å¤</span>
    `;
  }
}

// HTMLè½¬ä¹‰
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// æ˜¾ç¤ºé€šçŸ¥
function showNotification(message, type = 'success') {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <div class="notification-content">
      <span class="notification-message">${message}</span>
      <button class="notification-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // è‡ªåŠ¨ç§»é™¤
  setTimeout(() => {
    notification.classList.add('notification-hiding');
    setTimeout(() => {
      if (notification.parentNode) {
        notification.remove();
      }
    }, 300);
  }, 3000);
}

// æ·»åŠ é€šçŸ¥æ ·å¼
const notificationStyles = document.createElement('style');
notificationStyles.textContent = `
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    max-width: 400px;
    border-radius: 8px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    animation: slideInRight 0.3s ease;
    transition: all 0.3s ease;
  }
  
  .notification.notification-hiding {
    animation: slideOutRight 0.3s ease;
    opacity: 0;
    transform: translateX(100%);
  }
  
  .notification-content {
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    color: white;
    font-weight: 500;
  }
  
  .notification.success .notification-content {
    background: var(--gradient-primary);
  }
  
  .notification.error .notification-content {
    background: var(--accent-pink);
  }
  
  .notification-close {
    background: none;
    border: none;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.2s ease;
  }
  
  .notification-close:hover {
    background: rgba(255, 255, 255, 0.2);
  }
  
  @keyframes slideInRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideOutRight {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }
`;
document.head.appendChild(notificationStyles);
</script>